Optionalにも取り組みました

今回の実装ではserverからclientへ、TCP通信で大きい量のデータを送ることで、ネットワークスループットを測定した。
client側でのconnectをした時点からserverがTCP用のfile descriptorを閉じた時間を比べた。

工夫した点としては、buffer sizeをなるべく大きくとり、システムコールを呼ぶ回数をなるべく少なくしたことである。

今回の実験で余分に測ってしまっているところは他に、「EOFを送っている部分」があるが、これも、大きい量を送っているため、誤差として無視できる。

実験結果は、
100000000000         15.712757638 　　50914.041853
となった。

pingコマンドを打って試してみると、window sizeが64 K バイトで、	
rtt min/avg/max/mdev = 0.018/0.042/0.060/0.013 ms
となった。
平均値について計算すると、12190Mbpsとなった。
この計算は、スループット (bps) = 2 * TCP ウィンドウサイズ (KB) * 8 / RTT (S)で行った。
pingは往復しているため2倍している。


友人と測定した時の結果は以下のようになった。
1024000000          8.770043421      934.088876

想像していたとおり、ネットワークの通信速度は遅くなった。



今回の友人との測定で、イーサーネットケーブルにip割り振る必要があり、そのためには/etc/netplan/以下のstatic.yamlを編集して、sudo netplan applyをすればよい。

yaml fileの中身は以下の用に記述した。
network:
    version: 2
   ethernets:
       eno1:
           addresses:
           - 192.168.0.1/24
           dhcp4: no

route -nで設定がきちんと行われているかどうかがわかる。





